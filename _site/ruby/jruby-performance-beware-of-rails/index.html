<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>JRuby Performance: Beware of Rails deprecated warnings &#8211; ['Sorted', 'Array'].sort</title>
<meta name="description" content="We recently upgraded our JRuby version from 1.3.x to 1.7.12 and suddenly noticed a huge regression in performance. Our requests were starting to slow down by 500 ms and that was huge for our customers.

">
<meta name="keywords" content="">

  

<!-- Twitter Cards -->
<meta name="twitter:title" content="JRuby Performance: Beware of Rails deprecated warnings">
<meta name="twitter:description" content="We recently upgraded our JRuby version from 1.3.x to 1.7.12 and suddenly noticed a huge regression in performance. Our requests were starting to slow down by 500 ms and that was huge for our customers.

">
<meta name="twitter:site" content="@amunda">


<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="JRuby Performance: Beware of Rails deprecated warnings">
<meta property="og:description" content="We recently upgraded our JRuby version from 1.3.x to 1.7.12 and suddenly noticed a huge regression in performance. Our requests were starting to slow down by 500 ms and that was huge for our customers.

">
<meta property="og:url" content="/ruby/jruby-performance-beware-of-rails/">
<meta property="og:site_name" content="['Sorted', 'Array'].sort">





<link rel="canonical" href="/ruby/jruby-performance-beware-of-rails/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="['Sorted', 'Array'].sort Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/">['Sorted','Array']<span>.sort()</span></a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="/about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="/posts/" >Sample Posts</a></li>
				
				    
				        
				    
				    <li><a href="/theme-setup/" >Theme Setup</a></li>
				
				    
				        
				        
				    <li><a href="http://mademistakes.com" target="_blank">Made Mistakes</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->

<div class="site-boundary">
</div>




<div id="main" role="main">
  <div class="article-author-side">
    
  

<div itemscope itemtype="http://schema.org/Person">


	<img src="/images/" class="bio-photo" alt=" bio photo">


  <h3 itemprop="name"></h3>
  <p></p>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
</div>
  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="/ruby/jruby-performance-beware-of-rails/" rel="bookmark" title="JRuby Performance: Beware of Rails deprecated warnings">JRuby Performance: Beware of Rails deprecated warnings</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>We recently upgraded our JRuby version from 1.3.x to 1.7.12 and suddenly noticed a huge regression in performance. Our requests were starting to slow down by 500 ms and that was huge for our customers.</p>

<p>We investigate what could be the potential issue and we used some low level tools like jstack to really nail down where threads were spending most of the time. After investigating, we saw that in our call trace lot of Thread.getStackTrace() calls were made by the app. This is an expensive call in Java.</p>

<p>We looked closely of where the calls were coming from and found out that deprecated warnings in Rails methods were causing these calls. Our first thought was that we will just disable the deprecated warnings in Rails by using this flag:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Deprecation</span><span class="o">.</span><span class="n">silenced</span> <span class="o">=</span><span class="kp">true</span></code></pre></div>

<p>But we still continue to see getStackTrace calls in our call traces. We further dig down in Rails code and found out that it was the Kernel ‘caller’ method which was the culprit.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Deprecation</span><span class="o">.</span><span class="n">warn</span> <span class="s2">&quot;Calling `assign_shortcuts` is deprecated and has no effect anymore.&quot;</span><span class="p">,</span> <span class="nb">caller</span></code></pre></div>

<p>Caller method in JRuby will call the getStackTrace method and this was used by ‘ActiveSupport::Deprecation.warn’ method to report the exact line of the offending method.</p>

<p>Since it was passed in as an argument to deprecated warnings method, logic for switching on/off deprecated warnings has no effect. So the ‘silenced’ flag didn’t help at all.</p>

<p>So our solution was to fix all the deprecated warnings and wherever we couldn’t fix the warnings, we had to monkey patch Rails and completely remove the deprecated method call from the method.</p>

<p>So please beware of Rails deprecated warnings in JRuby!</p>

      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=/ruby/jruby-performance-beware-of-rails/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/ruby/jruby-performance-beware-of-rails/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/ruby/jruby-performance-beware-of-rails/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>JRuby Performance: Beware of Rails deprecated warnings</strong> was published on <time datetime="2014-08-11T02:52:18-04:00">August 11, 2014</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/ruby/handling-s3-incompletebody-error-when-using-asset_sync-gem/" title="Handling S3 IncompleteBody error when using asset_sync gem">Handling S3 IncompleteBody error when using asset_sync gem</a></li>
    
      <li><a href="/javascript/breakdown-of-bootstrap-plugin/" title="Breakdown of Bootstrap Plugin">Breakdown of Bootstrap Plugin</a></li>
    
      <li><a href="/character%20encodings/open-sans-fonts-can-break-accent-characters/" title="Open Sans fonts can break accent characters">Open Sans fonts can break accent characters</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    

<span>&copy; 2015 Abdul Munda. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>

	        

</body>
</html>